// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Project {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  owner         User     @relation("owner", fields: [ownerUsername], references: [id])
  ownerUsername String   @db.ObjectId
  developers    User[]   @relation("developers", fields: [developerIds], references: [id])
  developerIds  String[] @db.ObjectId
  bugs          Bug[]
  bugIds        String[] @db.ObjectId
  createdAt     DateTime @default(now())
  lastUpdated   DateTime @updatedAt
}

model User {
  id                 String    @id @default(auto()) @map("_id") @db.ObjectId
  username           String    @unique @db.ObjectId
  email              String    @unique
  password           String
  avatarUrl          String?
  ownedProjects      Project[] @relation("owner")
  ownedProjectIds    String[]  @db.ObjectId
  assignedProjects   Project[] @relation("developers", fields: [assignedProjectIds], references: [id])
  assignedProjectIds String[]  @db.ObjectId
  assignedBugs       Bug[]     @relation("assignedBugs")
  comments           Comment[]
  commentIds         String[]  @db.ObjectId
  reportedBugs       Bug[]     @relation("reportedBugs")
}

model Bug {
  id                String    @id @default(auto()) @map("_id") @db.ObjectId
  summary           String?
  markdown          String
  priority          Priority
  status            Status    @default(UNASSIGNED)
  minutesToComplete Int
  createdAt         DateTime  @default(now())
  lastUpdated       DateTime  @updatedAt
  reportingUser     User      @relation("reportedBugs", fields: [reportingUserId], references: [id])
  reportingUserId   String    @db.ObjectId
  assignedTo        User?     @relation("assignedBugs", fields: [assignedToUserId], references: [id])
  assignedToUserId  String?   @db.ObjectId
  comments          Comment[]
  project           Project   @relation(fields: [projectId], references: [id])
  projectId         String    @db.ObjectId
}

model Comment {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  author         User     @relation(fields: [authorUsername], references: [username])
  bug            Bug      @relation(fields: [bugId], references: [id])
  markdown       String
  createdAt      DateTime @default(now())
  lastUpdated    DateTime @updatedAt
  authorUsername String   @db.ObjectId
  bugId          String   @db.ObjectId
}

enum Priority {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum Status {
  UNASSIGNED
  INPROGRESS
  TESTING
  TODO
  CLOSED
}
